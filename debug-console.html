<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω—Å–æ–ª–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .debug-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        .btn:hover {
            background: #0056b3;
        }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω—Å–æ–ª–∏</h1>
    
    <div class="debug-section">
        <h2>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é</h2>
        <button class="btn" onclick="checkInitialization()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é</button>
        <button class="btn" onclick="checkTransactionManager()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å TransactionManager</button>
        <button class="btn" onclick="checkLocalStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
        <button class="btn" onclick="addTestTransaction()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
        <button class="btn" onclick="forceRenderTransactions()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</button>
    </div>
    
    <div class="debug-section">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
        <div id="debug-results"></div>
    </div>
    
    <div class="debug-section">
        <h2>–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</h2>
        <a href="/index.html#transactions" class="btn">–û—Ç–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</a>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('debug-results');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue';
            results.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function checkInitialization() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ —Å–∫—Ä–∏–ø—Ç—ã
            if (typeof BugalterAIApp === 'undefined') {
                log('‚ùå BugalterAIApp –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', 'error');
            } else {
                log('‚úÖ BugalterAIApp –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', 'success');
            }
            
            if (typeof TransactionManager === 'undefined') {
                log('‚ùå TransactionManager –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', 'error');
            } else {
                log('‚úÖ TransactionManager –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', 'success');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            if (typeof window.bugalterApp === 'undefined') {
                log('‚ùå window.bugalterApp –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', 'error');
            } else {
                log('‚úÖ window.bugalterApp –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', 'success');
            }
        }
        
        function checkTransactionManager() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ TransactionManager...');
            
            if (window.bugalterApp && window.bugalterApp.transactionManager) {
                log('‚úÖ TransactionManager –Ω–∞–π–¥–µ–Ω', 'success');
                log(`TransactionManager: ${window.bugalterApp.transactionManager}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥—ã
                if (typeof window.bugalterApp.transactionManager.renderTransactionsTable === 'function') {
                    log('‚úÖ renderTransactionsTable –º–µ—Ç–æ–¥ –Ω–∞–π–¥–µ–Ω', 'success');
                } else {
                    log('‚ùå renderTransactionsTable –º–µ—Ç–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
            } else {
                log('‚ùå TransactionManager –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            }
        }
        
        function checkLocalStorage() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage...');
            
            const transactions = localStorage.getItem('transactions');
            if (transactions) {
                const parsed = JSON.parse(transactions);
                log(`‚úÖ localStorage —Å–æ–¥–µ—Ä–∂–∏—Ç ${parsed.length} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π`, 'success');
                log(`–î–∞–Ω–Ω—ã–µ: ${transactions.substring(0, 200)}...`);
            } else {
                log('‚ùå localStorage –ø—É—Å—Ç', 'error');
            }
        }
        
        function addTestTransaction() {
            log('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...');
            
            const transaction = {
                id: Date.now(),
                amount: 10000,
                type: 'income',
                category: 'salary',
                description: '–¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è',
                date: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };
            
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            log('‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
        }
        
        function forceRenderTransactions() {
            log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π...');
            
            if (window.bugalterApp && window.bugalterApp.transactionManager) {
                try {
                    window.bugalterApp.transactionManager.renderTransactionsTable();
                    log('‚úÖ renderTransactionsTable –≤—ã–∑–≤–∞–Ω', 'success');
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ renderTransactionsTable: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå TransactionManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É...');
            setTimeout(() => {
                checkInitialization();
                checkTransactionManager();
                checkLocalStorage();
            }, 1000);
        });
    </script>
</body>
</html> 